# 算命学API機能再実装プロジェクト - セッション記録

## プロジェクト概要
- **目的**: 算命学API機能を1から再実装
- **算出項目**: 年齢, 星座, 動物占い, 6星占術
- **参考サイト**: 
  - 動物占い: https://dai-memo.com/422/
  - 6星占術: https://hosokikazuko.com/unmeisu#a3

## 現在の実装状況分析

### ✅ 実装済み機能
- 年齢計算（基本的な満年齢）
- 干支（十二支）計算
- 動物占い（CSVデータベース活用）
- 六星占術（CSVデータベース活用）
- 基本的なエラーハンドリング

### ❌ 未実装・要改善項目
1. **星座計算（完全に欠落）**
2. **算命学（天中殺）計算**
3. **タイムゾーン考慮不足**
4. **パフォーマンス最適化**

## 参考サイト調査結果

### 動物占い計算ロジック（dai-memo.com）
- **分類**: 60種類（12基本動物 × 5バリエーション）
- **計算式**: `Character No. = [(Serial Value + 8) % 60] + 1`
- **データ構造**: Excelシリアル値ベース
- **特徴**: 詳細性格分析（例："長距離ランナーのチータ"）

### 六星占術計算ロジック（hosokikazuko.com）
- **分類**: 6星人（土星、金星、火星、水星、天王星、木星）各±
- **手順**: 生年月日 → 運命数 → 星人タイプ
- **データ構造**: 複雑な年度別ルックアップテーブル
- **特徴**: 細木数子版、非線形マッピング

## ユーザー要件
1. **技術仕様**:
   - 星座: 日本標準時
   - 動物占い: 60種類版
   - 6星占術: 細木数子版
   - 算命学: 指定項目以外算出しない

2. **パフォーマンス要件**:
   - 同時接続: 50人
   - 応答時間: 1s以内
   - レスポンス時間: 100ms以内
   - キャッシュ戦略: 必要

3. **その他要件**:
   - データ検証: 10セットの正解表で検証
   - 精度保証: 参考サイトとの照合
   - セキュリティ: ログ保存なし、レート制限なし

## 実装差分分析

### 即座実装項目
1. **星座計算機能**: 日本標準時での境界判定
2. **動物占い計算式化**: CSV依存からの脱却

### 中期改善項目
3. **算命学（天中殺）実装**: 干支ベースの計算
4. **キャッシュ戦略**: メモリキャッシュによる高速化

## 推奨実装順序
1. ⭐ 星座計算（最も簡単、即効性あり）
2. 🔄 動物占い計算式化（パフォーマンス向上）
3. 🏛️ 算命学実装（新機能追加）
4. 🚀 キャッシュ最適化（総仕上げ）

## 次回セッションでの優先タスク
- 星座計算機能の実装
- 動物占い計算式の実装
- 10セットの正解データ作成と検証

## 技術的発見
- 現在のCSVファイル読み込み方式はパフォーマンスボトルネック
- 参考サイトの計算式実装により大幅な高速化が期待できる
- 日本標準時での星座境界判定が重要