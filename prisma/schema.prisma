generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model AdminUser {
  id        String    @id @default(cuid())
  username  String    @unique
  password  String
  role      String    @default("viewer")
  lastLogin DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@map("admin_users")
}

model DiagnosisRecord {
  id                 Int      @id @default(autoincrement())
  sessionId          String?  @unique // Unique session identifier for idempotency
  date               String
  name               String
  birthDate          String
  age                Int
  gender             String
  zodiac             String
  animal             String
  orientation        String
  color              String
  mbti               String
  mainTaiheki        Int
  subTaiheki         Int?
  sixStar            String
  theme              String
  advice             String
  satisfaction       Int
  duration           String
  feedback           String
  reportUrl          String?
  interviewScheduled String?
  interviewDone      String?
  memo               String?
  integratedKeywords String?
  aiSummary          String?
  fortuneColor       String?
  reportVersion      String?
  isIntegratedReport Boolean  @default(false)
  markdownContent    String?
  markdownVersion    String?
  counselingSummary  String?  // AI counseling chat summary (JSON stringified)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  @@map("diagnosis_records")
}

model AnimalMaster {
  id          Int      @id @default(autoincrement())
  animal      String   @unique
  orientation String
  trait       String
  strength    String
  caution     String
  createdAt   DateTime @default(now())

  @@map("animal_master")
}

model ZodiacMaster {
  id        Int      @id @default(autoincrement())
  zodiac    String   @unique
  period    String
  element   String
  nature    String
  ruler     String
  createdAt DateTime @default(now())

  @@map("zodiac_master")
}

model MbtiMaster {
  id        Int      @id @default(autoincrement())
  type      String   @unique
  nickname  String
  trait     String
  strength  String
  caution   String
  createdAt DateTime @default(now())

  @@map("mbti_master")
}

model TaihekiMaster {
  id        Int      @id @default(autoincrement())
  number    String   @unique
  type      String
  trait     String
  pattern   String
  career    String
  createdAt DateTime @default(now())

  @@map("taiheki_master")
}

model SixStarMaster {
  id        Int      @id @default(autoincrement())
  star      String
  plusminus String
  trait     String
  career    String
  caution   String
  createdAt DateTime @default(now())

  @@unique([star, plusminus])
  @@map("six_star_master")
}

model SystemConfig {
  id        String   @id @default(cuid())
  key       String   @unique
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("system_config")
}
