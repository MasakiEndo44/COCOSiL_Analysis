// COCOSiL 管理者用データベーススキーマ

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./admin.db"
}

// 管理者アカウント
model AdminUser {
  id        String   @id @default(cuid())
  username  String   @unique
  password  String   // ハッシュ化されたパスワード
  role      String   @default("viewer") // admin | viewer
  lastLogin DateTime?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("admin_users")
}

// 診断記録メイン
model DiagnosisRecord {
  id                  Int      @id @default(autoincrement())
  date                String   // YYYY-MM-DD形式
  name                String
  birthDate           String   // YYYY/MM/DD形式
  age                 Int
  gender              String   // male | female | no_answer
  zodiac              String   // 星座
  animal              String   // 動物占い
  orientation         String   // 志向（動物から自動計算）
  color               String   // 動物占いの色（統合診断では算命学の色）
  mbti                String   // MBTIタイプ
  mainTaiheki         Int      // 主体癖
  subTaiheki          Int?     // 副体癖（任意）
  sixStar             String   // 6星占術
  theme               String   // 相談テーマ（統合診断では統合キーワード）
  advice              String   // 提供アドバイス
  satisfaction        Int      // 満足度 1-5
  duration            String   // 所要時間
  feedback            String   // クライアント感想
  reportUrl           String?  // レポートURL
  interviewScheduled  String?  // インタビュー予定日
  interviewDone       String?  // インタビュー実施日
  memo                String?  // 備考
  // 統合診断専用フィールド
  integratedKeywords  String?  // 統合キーワード（JSON配列）
  aiSummary           String?  // AIサマリー
  fortuneColor        String?  // 算命学由来の色
  reportVersion       String?  // レポートバージョン
  isIntegratedReport  Boolean  @default(false) // 統合診断か手動入力かの判別
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  @@map("diagnosis_records")
}

// マスターデータ: 動物占い
model AnimalMaster {
  id          Int    @id @default(autoincrement())
  animal      String @unique
  orientation String
  trait       String
  strength    String
  caution     String
  createdAt   DateTime @default(now())

  @@map("animal_master")
}

// マスターデータ: 星座
model ZodiacMaster {
  id        Int    @id @default(autoincrement())
  zodiac    String @unique
  period    String
  element   String
  nature    String
  ruler     String
  createdAt DateTime @default(now())

  @@map("zodiac_master")
}

// マスターデータ: MBTI
model MbtiMaster {
  id        Int    @id @default(autoincrement())
  type      String @unique
  nickname  String
  trait     String
  strength  String
  caution   String
  createdAt DateTime @default(now())

  @@map("mbti_master")
}

// マスターデータ: 体癖
model TaihekiMaster {
  id        Int    @id @default(autoincrement())
  number    String @unique
  type      String
  trait     String
  pattern   String
  career    String
  createdAt DateTime @default(now())

  @@map("taiheki_master")
}

// マスターデータ: 6星占術
model SixStarMaster {
  id        Int    @id @default(autoincrement())
  star      String 
  plusminus String
  trait     String
  career    String
  caution   String
  createdAt DateTime @default(now())

  @@unique([star, plusminus])
  @@map("six_star_master")
}


// システム設定
model SystemConfig {
  id        String   @id @default(cuid())
  key       String   @unique
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("system_config")
}